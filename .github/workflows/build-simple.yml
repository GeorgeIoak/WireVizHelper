name: Build Simple EXE

on:
  workflow_dispatch:
  push:
    branches: [ main, Package ]

jobs:
  build:
    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install dependencies
        run: pip install -r requirements.txt pyinstaller

      - name: Create vendor directory
        run: |
          New-Item -ItemType Directory -Force -Path vendor | Out-Null
          New-Item -ItemType Directory -Force -Path vendor/graphviz | Out-Null
          New-Item -ItemType Directory -Force -Path vendor/wkhtmltopdf | Out-Null

      - name: Download Graphviz portable
        run: |
          curl -L -o graphviz.zip https://gitlab.com/api/v4/projects/4207231/packages/generic/graphviz-releases/10.0.1/graphviz-portable-10.0.1.zip
          tar -xf graphviz.zip -C vendor/graphviz --strip-components=1

      - name: Download wkhtmltopdf portable
        run: |
          curl -L -o wkhtml.zip https://github.com/wkhtmltopdf/packaging/releases/download/0.12.6-1/wkhtmltox-0.12.6-1.msvc2015-win64.zip
          tar -xf wkhtml.zip -C vendor/wkhtmltopdf --strip-components=1

      - name: Build simple EXE
        run: pyinstaller WireVizProjectAssistant.simple.spec

      - uses: actions/upload-artifact@v4
        with:
          name: WireVizProjectAssistant-simple
          path: dist/WireVizProjectAssistant-simple.exe
